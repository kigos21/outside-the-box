// LOCAL
datasource db {
  provider = "postgresql"
  url      = env("DIRECT_URL")
  // directUrl = env("DIRECT_URL")
}

// SUPABASE
// datasource db {
//   provider  = "postgresql"
//   url       = env("DATABASE_URL")
//   directUrl = env("DIRECT_URL")
// }

generator client {
  provider = "prisma-client-js"
}

// SCHEMA
model Admin {
  id            String @id @default(uuid())
  username      String @unique
  password      String
  contactNumber String
  otps          OTP[]
}

model OTP {
  id         String    @id @default(uuid())
  admin      Admin?    @relation(fields: [adminId], references: [id], onDelete: Cascade)
  adminId    String?
  customer   Customer? @relation(fields: [customerId], references: [id], onDelete: Cascade)
  customerId String?
  otp        String    @unique
  createdAt  DateTime  @default(now())
  expiresAt  DateTime  @default(dbgenerated("NOW() + INTERVAL '10 minutes'"))
}

model FacilityReservation {
  id         String   @id @default(uuid())
  customer   Customer @relation(name: "Customer", fields: [customerId], references: [id], onDelete: Cascade)
  customerId String
  date       DateTime
  startTime  DateTime
  endTime    DateTime
  price      Float
  // Details for reservation
  email          String
  attendees      String
  purpose        String
  additionalInfo String
}


model Customer {
  id                   String                @id @default(uuid())
  firstName            String
  lastName             String
  occupation           String
  affiliation          String
  mobileNumber         String
  username             String                @unique
  password             String
  otps                 OTP[]
  facilityReservations FacilityReservation[] @relation("Customer")
  Log                  Log[]
  SeatReservation      SeatReservation[]
}

model Log {
  id                     String                @id @default(uuid())
  customer               Customer              @relation(fields: [customerId], references: [id], onDelete: Cascade)
  customerId             String
  service                Service               @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId              String
  date                   DateTime
  timeIn                 DateTime
  timeOut                DateTime
  confirmedReservation   ConfirmedReservation? @relation(fields: [confirmedReservationId], references: [id], onDelete: Cascade)
  confirmedReservationId String?
}

model ConfirmedReservation {
  id                String          @id @default(uuid())
  seatReservation   SeatReservation @relation(fields: [seatReservationId], references: [id], onDelete: Cascade)
  seatReservationId String
  date              DateTime
  Log               Log[]
}

model SeatReservation {
  id                   String                 @id @default(uuid())
  customer             Customer               @relation(fields: [customerId], references: [id], onDelete: Cascade)
  customerId           String
  service              Service                @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId            String
  date                 DateTime
  startTime            DateTime
  endTime              DateTime
  ConfirmedReservation ConfirmedReservation[]
  ArchivedReservation  ArchivedReservation[]
}

model Service {
  id              String            @id @default(uuid())
  name            String
  hours           Int
  price           Float
  type            String
  logs            Log[]
  SeatReservation SeatReservation[]
}

model Report {
  id        String   @id @default(uuid())
  logIds    String[]
  createdAt DateTime @default(now())
}

model ArchivedReservation {
  id                String          @id @default(uuid())
  seatReservation   SeatReservation @relation(fields: [seatReservationId], references: [id], onDelete: Cascade)
  seatReservationId String
  archivedAt        DateTime        @default(now())
}
